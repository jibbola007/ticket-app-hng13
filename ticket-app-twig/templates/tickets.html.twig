{% extends "base.html.twig" %}

{% block content %}
<main class="min-h-screen bg-gray-50">
  <!-- NAVBAR -->
  <nav class="bg-white shadow-sm py-4">
    <div class="max-w-[1440px] mx-auto flex justify-between items-center px-6">
      <h1 class="text-2xl font-bold text-blue-700"> Ticket Dashboard</h1>
      <div class="flex items-center gap-5">
        <a href="index.php?page=dashboard" class="text-gray-700 hover:text-blue-600 font-medium transition-all">Dashboard</a>
        <a href="auth.php?action=logout"
           class="bg-red-600 hover:bg-red-700 text-white font-semibold px-5 py-2 rounded-lg shadow-sm transition-all">Logout</a>
      </div>
    </div>
  </nav>

  <!-- CONTENT -->
  <section class="max-w-[1440px] mx-auto p-6 md:p-10">
    <!-- FEEDBACK MESSAGES -->
    {% if error %}
      <div class="max-w-3xl mx-auto bg-red-50 text-red-700 border border-red-200 px-4 py-3 rounded-lg mb-6">
        ‚ùå {{ error }}
      </div>
    {% endif %}
    {% if message %}
      <div class="max-w-3xl mx-auto bg-green-50 text-green-700 border border-green-200 px-4 py-3 rounded-lg mb-6">
        ‚úÖ {{ message }}
      </div>
    {% endif %}

    <!-- FORM -->
    <div class="bg-white p-8 rounded-2xl shadow-md border border-gray-100 mb-10">
      <h2 class="text-2xl font-semibold text-blue-700 mb-6">
        {{ (editTicket is defined and editTicket) ? ' Edit Ticket' : ' Create New Ticket' }}
      </h2>

      <form method="POST" action="index.php?page=tickets&action=save">
        {% if editTicket is defined and editTicket %}
          <input type="hidden" name="id" value="{{ editTicket.id }}" />
        {% endif %}

        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Title *</label>
            <input type="text" name="title"
                   class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none"
                   value="{{ (editTicket is defined and editTicket) ? editTicket.title : '' }}" required />
          </div>

          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Status *</label>
            <select name="status"
                    class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none"
                    required>
              <option value="open" {% if editTicket is defined and editTicket and editTicket.status == 'open' %}selected{% endif %}>Open</option>
              <option value="in_progress" {% if editTicket is defined and editTicket and editTicket.status == 'in_progress' %}selected{% endif %}>In Progress</option>
              <option value="closed" {% if editTicket is defined and editTicket and editTicket.status == 'closed' %}selected{% endif %}>Closed</option>
            </select>
          </div>
        </div>

        <div class="mt-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
          <textarea name="description"
                    class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                    rows="4">{{ (editTicket is defined and editTicket) ? editTicket.description : '' }}</textarea>
        </div>

        <div class="flex items-center justify-between mt-8">
          <button type="submit"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg shadow-md transition-all">
            {{ (editTicket is defined and editTicket) ? 'Update Ticket' : 'Add Ticket' }}
          </button>

          {% if editTicket is defined and editTicket %}
            <a href="index.php?page=tickets" class="text-gray-600 hover:text-gray-900 underline">Cancel Edit</a>
          {% endif %}
        </div>
      </form>
    </div>

    <!-- TICKET LIST -->
    <div>
      <h2 class="text-2xl font-bold text-gray-800 mb-6">üìã Your Tickets</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {% if tickets|length > 0 %}
          {% for t in tickets %}
            <div class="bg-white p-6 rounded-xl shadow-md border-l-4
              {% if t.status == 'open' %}
                border-green-500
              {% elseif t.status == 'in_progress' %}
                border-amber-500
              {% else %}
                border-gray-400
              {% endif %}
            ">
              <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ t.title }}</h3>
              <p class="text-sm text-gray-500 mb-3">{{ t.description ?: 'No description provided' }}</p>

              <span class="inline-block text-xs px-3 py-1 rounded-full font-medium
                {% if t.status == 'open' %}
                  bg-green-100 text-green-700
                {% elseif t.status == 'in_progress' %}
                  bg-amber-100 text-amber-700
                {% else %}
                  bg-gray-100 text-gray-700
                {% endif %}
              ">
                {{ t.status }}
              </span>

              <div class="flex gap-3 mt-5">
                <a href="tickets.php?action=edit&id={{ t.id }}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm">Edit</a>
                <a href="tickets.php?action=delete&id={{ t.id }}" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm">Delete</a>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-gray-500 text-center col-span-full">No tickets yet. Create one above!</p>
        {% endif %}
      </div>
    </div>
  </section>
</main>
{% endblock %}
